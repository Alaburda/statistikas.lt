---
title: "Statistinė analizė per 3 valandas"
author: "Paulius Alaburda"
format: 
  revealjs:
    width: 1600
---

## 

## Ko išmoksime?

-   Pasirinkti tinkamą statistinį testą
-   Palyginti 2 grupes tarpusavyje
-   Palyginti 3+ grupes tarpusavyje
-   Atlikti koreliaciją
-   Atlikti išgyvenamumo analizę

## Ko neišmoksime?

-   Tiesinė regresija
-   Logistinė regresija

## Kokių priemonių reikės?

Mokymus galima sekti šiais būdais:

-   Susikurti paskyrą [Posit Cloud](https://posit.cloud/) svetainėje - nereikia siųstis programinės įrangos!
    -   Posit Cloud yra greičiausias būdas pradėti
-   Parsisiųsti [RStudio](https://posit.co/download/rstudio-desktop/), jeigu norite naudotis R bei sekti [šį diegimo gidą](../kaip-pasirengti-rstudio/kaip-pasirengti-rstudio.qmd);
-   Parsiųsti [XLMiner Analysis ToolPak](https://appsource.microsoft.com/en-us/product/office/wa104379190?tab=overview&exp=ubp8), jeigu norite naudotis Excel;
-   Naudotis demonstracine [Statistikas aplikacija](https://statistikas.shinyapps.io/statistikas/)

## Kaip pasirengti Posit Cloud paskyrą?

-   Užsiregistruoti [čia](https://login.posit.cloud/register).

-   Posit pradiniame lange pasirinkti Posit Cloud:

![](images/image-1832016710.png)

## Susikurti naują RStudio aplinką

![](images/image-1067007752.png)

Posit jums sukurs virtualią RStudio aplinką. Ši aplinka yra praktiškai tokia pati kaip parsisiuntus RStudio. Apie RStudio detalesnis aprašas [čia](../kaip-pasirengti-rstudio/kaip-pasirengti-rstudio.qmd).

# Kas yra tiesiniai modeliai?

## Tiesiniai modeliai ranka

::: columns
::: {.column width="50%"}
![](images/image-1204024637.png)
:::

::: {.column width="50%"}
![](images/image-1285293873.png)
:::
:::

## Parametriniai statistiniai testai

Dauguma parametrinių statistinių testų yra specifinės tiesinių modelių versijos. Tiesiniai modeliai turi formą $y = a*x + b$, kur **y** yra mūsų priklausomas kintamasis, o **x** - nepriklausomas kintamasis.

. . .

::: columns
::: {.column width="40%"}
Pavyzdžiui:

```{r, echo = FALSE}

library(dplyr)
library(knitr)

data.frame(Baterija = c("10%","20%","30%","70%","100%"), 
           `Minutės` = c(0,10,20,60,90)) %>% 
  knitr::kable()

```
:::

::: {.column width="60%"}
Remiantis lentele, tiesinis modelis galėtų atrodyti taip:

y = 1\*x + 10
:::
:::

## Bet realybė nėra tokia tvarkinga...

Pavyzdžiui, grafike matome `penguins` duomenų rinkinio kūno masės ir pelekų ilgį. Akivaizdu, jog priklausomybė yra tiesiška ir proporcinga -- kokia pora **a** ir **b** kintamųjų geriausiai apibūdintų ryšį?

```{r, echo = FALSE}

library(ggplot2)
library(palmerpenguins)

penguin_plot <- ggplot(penguins, aes(x = body_mass_g, y = flipper_length_mm)) + geom_point()

penguin_plot
```

## Kuri tiesė teisinga? Ar tai turėtų būti tiesė apskritai?

"Iš akies" galėtume nubrėžti kalibracinę tiesę, bet ar tai optimaliausia tiesė, kuri geriausiai apibūdintų **visus** mūsų atliktus matavimus? Juo labiau, ar tiesė geriausiai apibūdina mūsų santykį, ar kreivė?

<div>

```{r, echo = FALSE}
#| fig-pos: 'c'

penguin_plot + geom_abline(slope = 0.01528, intercept = 136.73, color = "navyblue", size = 1.5) + geom_abline(slope = 0.019, intercept = 120, color = "salmon", size = 1.5) + geom_smooth(method = "loess", se = FALSE, color = "magenta")
```

</div>

## OLS -- ordinary least squares (liet. mažiausių kvadratų modelis)

::: columns
::: {.column width="40%"}
OLS yra tiesinis metodas, kuris nustato nežinomus parametrus tiesinės regresijos modelyje. Metodo tikslas yra sumažinti skirtumų tarp matavimų ir tiesės kvadratų sumą.

**Kitaip tariant, metodas nustato, kuri tiesė turi mažiausią paklaidą santykiu su mūsų matavimais.**
:::

::: {.column width="60%"}
![](images/pca.gif){width="460"}
:::
:::

## OLS yra labai patogus modelis

-   **Lengva apibendrinti** - nepaisant nepriklausomo kintamojo, ryšys tarp jo ir priklausomo kintamojo visada išlieka toks pats. Galime drąsiai teigti, jog "kiekvienas papildomas pingvino gramas yra susijęs su 0.01528 mm ilgesniu peleku".

. . .

-   **Lengva interpretuoti** - duomenys liko tuose pačiuose matavimo vienetuose. Logistinės regresijos modeliai bei bendriniai tiesiniai modeliai turi būti interpretuojami per šansų santykius, procentinius pokyčius ir pan.

. . .

-   **Greitas** - sudėtingi Bajeso modeliai yra tinkamesni, bet gali trukti minutes (o dideli ir valandas!), kol bus apskaičiuoti.

## OLS turi savo kainą

::: columns
::: {.column width="40%"}
-   Tiesiniai modeliai taip pat apskaičiuoja paklaidą - ji turi būti vienoda visoje matavimo aibėje (heteroskedatiškumas)
-   Tiesiniai modelių paklaida taip pat turi būti pasiskirsčiusi pagal normalųjį skirstinį
-   Matavimai turi būti nepriklausomi vienas nuo kito
:::

::: {.column width="60%"}
```{r, echo = FALSE}

penguin_plot + geom_smooth(method = "lm", color = "magenta") + labs(title = "Ar tiesinis modelis yra tinkamas apibūdinti santykį tarp svorio pelekų ilgio?")
```
:::
:::

## Kada netaikyti tiesinių modelių?

::: columns
::: {.column width="30%"}
-   Ar tiesė yra pakankamai geras būdas apibūdinti ryšį tarp mano kintamųjų?

-   Jeigu iš duomenų negalima to pasakyti, ar iš principo tiesė būtų geras būdas apibūdinti ryšį?
:::

::: {.column width="70%"}
```{r, echo = FALSE}

library(dplyr)
library(tidyr)

anscombe_tidy <- anscombe %>%
    mutate(observation = seq_len(n())) %>%
    pivot_longer(names_to = "key", values_to = "value", -observation) %>%
    separate(key, c("variable", "set"), 1, convert = TRUE) %>%
    mutate(set = c("I", "II", "III", "IV")[set]) %>% 
    pivot_wider(names_from = "variable", values_from = "value")

ggplot(anscombe_tidy, aes(x, y)) +
    geom_point() +
    facet_wrap(~ set) +
    geom_smooth(method = "lm", se = FALSE) + 
    labs(title = "Anscombe’s kvartetas", subtitle = "Visi 4 grafikai turi vienodus vidurkius, variaciją bei tiesinės regresijos tieses")

```
:::
:::

# Alternatyva tiesiniams modeliams

## Neparametriniai testai yra tiesiog ranginiai modeliai

::: columns
::: {.column width="70%"}
Grubiai, kiekvienas atitinkamas neparametrinis testas pirma ranguoja duomenis, o tada atlieka statistinį testą.

```{r, echo = FALSE}

library(dplyr)
library(knitr)

data.frame(Baterija = c("10%","20%","30%","70%","100%"), 
           `Minutės` = c(0,10,20,60,90),
           Rangas = 1:5) %>% 
  knitr::kable()

```
:::

::: {.column width="30%"}
Pavyzdžiui, Spearman koreliacijos koeficientas yra identiškas tiesinės regresijos *a* koeficientui, jeigu suvienodiname priklausomo ir nepriklausomo kintamojo standartinius nuokrypius.

```{r, echo = FALSE, warning = FALSE}

a = cor.test(penguins$flipper_length_mm, penguins$body_mass_g, method = "spearman")

b = lm(rank(flipper_length_mm) ~ rank(body_mass_g), data = penguins)

a$estimate
b$coefficients

```
:::
:::

# Susipažinimas su RStudio Cloud

Darbui su RStudio Cloud mums reikės šių paketų:

```{r, eval = FALSE, echo = TRUE}

install.packages(c("reaxl","ggplot2","dplyr","tidyr"))

```

# Pagrindiniai statistiniai testai

## Spearman koreliacijos koeficientas

::: columns
::: {.column width="50%"}
```{r, echo = TRUE}

cor.test(penguins$flipper_length_mm, penguins$body_mass_g, method = "pearson")
```
:::

::: {.column width="50%"}
![Iliustracija iš Danielle Navarro knygos "Learning Statistics with R". Kuo koreliacija yra arčiau nulio, tau labiau mūsų duomenys panašūs į debesėlį. 1 ir -1 yra, atitinkamai, tobula teigiama bei neigiama koreliacija.](../posts/kaip-apskaiciuoti-koreliacija/images/image-1260747057.png){width="374"}
:::
:::

## Pearson koreliacijos koeficientas

```{r, echo = TRUE}

cor.test(penguins$flipper_length_mm, penguins$body_mass_g, method = "spearman")

```

## Stjudento t-testas

::: columns
::: {.column width="50%"}
```{r, echo = TRUE}

t.test(data = penguins, flipper_length_mm ~ sex)
```

"Atlikus Stjudento t-testą, vidutinis pelekų ilgio skirtumas tarp pingvinių lyčių buvo 7,14 mm, skirtumas buvo statistiškai reikšmingas (t = 4,80, 95% PI 4,21-10,06, p \< 0,001)."
:::

::: {.column width="50%"}
```{r, echo = TRUE}

ggplot(data = penguins, aes(x = sex, y = flipper_length_mm)) + geom_boxplot()
```
:::
:::

## Mann-Whitney U

```{r, echo = TRUE}

wilcox.test(data = penguins, flipper_length_mm ~ sex)

```

## Poruotas Stjudento t-testas

## Wilcoxon ranginis testas

## VIenpusė ANOVA

## Kruskal-Wallis testas

## Dvipusė ANOVA

## Post-hoc testai

## Išgyvenamumo analizė
